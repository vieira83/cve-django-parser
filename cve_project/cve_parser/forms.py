from django import forms
from datetime import datetime
from django.forms import ModelForm, HiddenInput, widgets
from cve_parser.models import CVEEntry


class ReadOnlyWidget(widgets.Widget):
    def render(self, _, value, attrs=None):
        return value


class CVEEntryForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super(CVEEntryForm, self).__init__(*args, **kwargs)
        instance = getattr(self, 'instance', None)
        if instance and instance.pk:
            self.fields['published_time'].widget = ReadOnlyWidget()
            self.fields['last_modified_time'].widget = ReadOnlyWidget()

    # def clean_last_modified_time(self):
    #     self.last_modified_time = datetime.now
    #     return self.last_modified_time

    def save(self, commit=True):
        instance = super(CVEEntryForm, self).save(commit=False)
        instance.last_modified_time = datetime.now
        instance.save()
        return instance

    class Meta:
        model = CVEEntry
        fields = ['published_time', 'cve_id', 'summary', 'security_protection', 'cwe', 'software_list', 'reference',
                  'cvss_base_metrics', 'last_modified_time']
